# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           gitlab 1.0

gitlab.setup        gstreamer gstreamer 1.22.7
gitlab.instance     https://gitlab.freedesktop.org/gstreamer
revision            0

name                ${gitlab.project}.framework
categories          multimedia
maintainers         {@gcenx}
description         GStreamer is a streaming media framework
long_description    {*}${description}

supported_archs     arm64 x86_64
platforms           {darwin >= 15}
license             LGPL-2+

homepage            https://gstreamer.freedesktop.org
master_sites        ${homepage}/data/pkg/osx/${version}/

distname            gstreamer-1.0-${version}-universal
set headername      gstreamer-1.0-devel-${version}-universal
extract.suffix      pkg

distfiles           ${distname}.${extract.suffix} \
                    ${headername}.${extract.suffix}

checksums \
    ${distname}.${extract.suffix} \
    rmd160  921adaa854f9d11e3fe0f91e9ef31cde57d9d6d8 \
    sha256  391b8be74ba93acca38b68cba4180f06793a4f0dcf18c17709161be4a1610a78 \
    size    179627866 \
    ${headername}.${extract.suffix} \
    rmd160  b07687a85a43d4c1eca913f6e36c67abe8db7717 \
    sha256  1c0c8c9585f6f0e046825071b0f16eb01cff01ec03c4bac5d2e46e37e8aa8921 \
    size    441873003

extract             {}
use_configure       no

build {
    if {![file exists /Library/Frameworks/GStreamer.framework ]} {
        elevateToRoot "installer"
        ui_msg "--->  Installing gstreamer-1.0-${version}-universal.pkg"
        system -W ${distpath} "installer -pkg gstreamer-1.0-${version}-universal.pkg -target /"
        ui_msg "--->  Installing gstreamer-1.0-devel-${version}-universal.pkg"
        system -W ${distpath} "installer -pkg gstreamer-1.0-devel-${version}-universal.pkg -target /"
    }
}

destroot {
    global destroot prefix
    set docdir ${destroot}${prefix}/share/doc/${subport}
    xinstall -d ${docdir}
    system "echo ${subport} is a stub port > ${docdir}/README"
}

uninstall {
    portuninstall::uninstall_main
    if {[file exists /Library/Frameworks/GStreamer.framework ]} {
        ui_msg "--->  Removing GStreamer.framework"
        delete -force /Library/Frameworks/GStreamer.framework
    }
}

variant universal {}
configure.universal_archs {*}${supported_archs}
default_variants +universal
variant_set universal
